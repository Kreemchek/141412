#!/usr/bin/env python3
"""
Telegram –±–æ—Ç –¥–ª—è –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ —é–Ω–∏—Ç-—ç–∫–æ–Ω–æ–º–∏–∫–∏
–ê–≤—Ç–æ—Ä: @MaksimovWB
"""

import telebot
import json
import os
from telebot.types import WebAppInfo, InlineKeyboardMarkup, InlineKeyboardButton

# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
TOKEN = os.getenv('BOT_TOKEN', 'YOUR_BOT_TOKEN_HERE')
WEB_APP_URL = os.getenv('WEB_APP_URL', 'https://–≤–∞—à-–¥–æ–º–µ–Ω.com/index.html')

# –°–æ–∑–¥–∞–µ–º –±–æ—Ç–∞
bot = telebot.TeleBot(TOKEN)

@bot.message_handler(commands=['start'])
def start_command(message):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start"""
    markup = InlineKeyboardMarkup()
    markup.add(InlineKeyboardButton(
        "üßÆ –û—Ç–∫—Ä—ã—Ç—å –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä",
        web_app=WebAppInfo(url=WEB_APP_URL)
    ))
    
    welcome_text = """
üëã *–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —é–Ω–∏—Ç-—ç–∫–æ–Ω–æ–º–∏–∫–∏!*

–≠—Ç–æ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –ø–æ–º–æ–∂–µ—Ç –≤–∞–º —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å –ø—Ä–∏–±—ã–ª—å–Ω–æ—Å—Ç—å —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ Wildberries.

üìä *–ß—Ç–æ –≤—ã –º–æ–∂–µ—Ç–µ —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å:*
‚Ä¢ –ú–∞—Ä–∂–∏–Ω–∞–ª—å–Ω–æ—Å—Ç—å –∏ —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å
‚Ä¢ –ü—Ä–∏–±—ã–ª—å –ø—Ä–∏ —Ä–∞–∑–Ω—ã—Ö –Ω–∞–ª–æ–≥–æ–≤—ã—Ö —Å—Ç–∞–≤–∫–∞—Ö (2%, 5%, 7%)
‚Ä¢ –í—Å–µ —Ä–∞—Å—Ö–æ–¥—ã WB (–ª–æ–≥–∏—Å—Ç–∏–∫–∞, –∫–æ–º–∏—Å—Å–∏–∏, —Ö—Ä–∞–Ω–µ–Ω–∏–µ)
‚Ä¢ –≠–∫–≤–∞–π—Ä–∏–Ω–≥ –∏ –Ω–∞–ª–æ–≥–æ–æ–±–ª–æ–∂–µ–Ω–∏–µ

üéØ *–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:*
1. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–û—Ç–∫—Ä—ã—Ç—å –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä"
2. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –æ —Ç–æ–≤–∞—Ä–µ
3. –ü–æ–ª—É—á–∏—Ç–µ –¥–µ—Ç–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç
4. –ü–æ–¥–µ–ª–∏—Ç–µ—Å—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏

ü§ñ *–°–æ–∑–¥–∞–Ω–æ @MaksimovWB* - —ç–∫—Å–ø–µ—Ä—Ç –ø–æ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–∞–º

–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å —Ä–∞—Å—á–µ—Ç—ã!
    """
    
    bot.send_message(
        message.chat.id,
        welcome_text,
        reply_markup=markup,
        parse_mode='Markdown'
    )

@bot.message_handler(commands=['help'])
def help_command(message):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /help"""
    help_text = """
üÜò *–ü–æ–º–æ—â—å –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞*

üìã *–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞:*
‚Ä¢ **–ü—Ä–æ–¥–∞–Ω–æ –µ–¥–∏–Ω–∏—Ü** - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–¥–∞–Ω–Ω–æ–≥–æ —Ç–æ–≤–∞—Ä–∞
‚Ä¢ **–õ–æ–≥–∏—Å—Ç–∏–∫–∞ –í–ë** - —Å—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏ (—Ä—É–±.)
‚Ä¢ **–§—É–ª—Ñ–∏–ª–º–µ–Ω—Ç** - —Å—Ç–æ–∏–º–æ—Å—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–∫–∞–∑–∞ (—Ä—É–±.)
‚Ä¢ **–ö–æ–º–∏—Å—Å–∏—è –í–ë** - –ø—Ä–æ—Ü–µ–Ω—Ç –∫–æ–º–∏—Å—Å–∏–∏ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–∞ (%)
‚Ä¢ **–°—Ç–æ–∏–º–æ—Å—Ç—å —Ö—Ä–∞–Ω–µ–Ω–∏—è –í–ë** - –ø–ª–∞—Ç–∞ –∑–∞ —Ö—Ä–∞–Ω–µ–Ω–∏–µ (—Ä—É–±.)
‚Ä¢ **–†–µ–∫–ª–∞–º–∞** - —Ä–∞—Å—Ö–æ–¥—ã –Ω–∞ –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ (—Ä—É–±.)
‚Ä¢ **–ó–∞–∫—É–ø–æ—á–Ω–∞—è —Ü–µ–Ω–∞ —Ç–æ–≤–∞—Ä–∞** - —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å (—Ä—É–±.)
‚Ä¢ **–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏** - —Ä–æ–∑–Ω–∏—á–Ω–∞—è —Ü–µ–Ω–∞ –Ω–∞ WB (—Ä—É–±.)
‚Ä¢ **–ü—Ä–æ—Ü–µ–Ω—Ç –≤—ã–∫—É–ø–∞** - –¥–æ–ª—è –≤—ã–∫—É–ø–ª–µ–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ (%)

üìà *–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á–µ—Ç–∞:*
‚Ä¢ –ú–∞—Ä–∂–∏–Ω–∞–ª—å–Ω–æ—Å—Ç—å - –æ—Ç–Ω–æ—à–µ–Ω–∏–µ –ø—Ä–∏–±—ã–ª–∏ –∫ –≤—ã—Ä—É—á–∫–µ
‚Ä¢ –†–µ–Ω—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å - –æ—Ç–Ω–æ—à–µ–Ω–∏–µ –ø—Ä–∏–±—ã–ª–∏ –∫ —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç–∏
‚Ä¢ –ü—Ä–∏–±—ã–ª—å –ø—Ä–∏ —Ä–∞–∑–Ω—ã—Ö –Ω–∞–ª–æ–≥–æ–≤—ã—Ö —Å—Ç–∞–≤–∫–∞—Ö

üí° *–°–æ–≤–µ—Ç—ã:*
‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ç–æ—á–Ω—ã—Ö —Ä–∞—Å—á–µ—Ç–æ–≤
‚Ä¢ –£—á–∏—Ç—ã–≤–∞–π—Ç–µ —Å–µ–∑–æ–Ω–Ω–æ—Å—Ç—å –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ –ø—Ä–æ—Ü–µ–Ω—Ç–∞ –≤—ã–∫—É–ø–∞
‚Ä¢ –†–µ–≥—É–ª—è—Ä–Ω–æ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–π—Ç–µ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–æ–º–∏—Å—Å–∏–π WB

ü§ñ *–ü–æ–¥–¥–µ—Ä–∂–∫–∞:* @MaksimovWB
    """
    
    bot.send_message(
        message.chat.id,
        help_text,
        parse_mode='Markdown'
    )

@bot.message_handler(commands=['about'])
def about_command(message):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /about"""
    about_text = """
‚ÑπÔ∏è *–û –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–µ —é–Ω–∏—Ç-—ç–∫–æ–Ω–æ–º–∏–∫–∏*

üéØ *–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:*
–≠—Ç–æ—Ç –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å–æ–∑–¥–∞–Ω –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ –ø—Ä–∏–±—ã–ª—å–Ω–æ—Å—Ç–∏ —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–µ Wildberries —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤ –∏ –Ω–∞–ª–æ–≥–æ–≤.

üë®‚Äçüíª *–ê–≤—Ç–æ—Ä:*
[@MaksimovWB](https://t.me/MaksimovWB) - —ç–∫—Å–ø–µ—Ä—Ç –ø–æ —Ä–∞–±–æ—Ç–µ —Å –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–∞–º–∏

üîß *–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:*
‚Ä¢ HTML5, CSS3, JavaScript
‚Ä¢ Telegram Web Apps API
‚Ä¢ –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω

üìä *–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:*
‚Ä¢ –†–∞—Å—á–µ—Ç –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –Ω–∞–ª–æ–≥–æ–≤—ã—Ö —Å—Ç–∞–≤–æ–∫
‚Ä¢ –£—á–µ—Ç –≤—Å–µ—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤ WB
‚Ä¢ –≠–∫—Å–ø–æ—Ä—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
‚Ä¢ –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

üöÄ *–í–µ—Ä—Å–∏—è:* 1.0.0

üìû *–°–≤—è–∑—å:* [@MaksimovWB](https://t.me/MaksimovWB)
    """
    
    bot.send_message(
        message.chat.id,
        about_text,
        parse_mode='Markdown'
    )

@bot.message_handler(func=lambda message: True)
def handle_web_app_data(message):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–∞–Ω–Ω—ã—Ö –æ—Ç Web App"""
    if message.web_app_data:
        try:
            data = json.loads(message.web_app_data.data)
            
            if data.get('type') == 'unit_economics_results':
                # –ü–æ–ª—É—á–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á–µ—Ç–∞
                results = data.get('data', {})
                message_text = data.get('message', '–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á–µ—Ç–∞')
                
                # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
                bot.send_message(
                    message.chat.id,
                    message_text,
                    parse_mode='Markdown'
                )
                
                # –õ–æ–≥–∏—Ä—É–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
                user_info = f"User: {message.from_user.username or message.from_user.first_name}"
                print(f"Calculation shared by {user_info}")
                
        except json.JSONDecodeError:
            bot.send_message(
                message.chat.id,
                "‚ùå –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑."
            )
        except Exception as e:
            print(f"Error handling web app data: {e}")
            bot.send_message(
                message.chat.id,
                "‚ùå –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ @MaksimovWB"
            )
    else:
        # –û–±—ã—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
        bot.send_message(
            message.chat.id,
            "ü§ñ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—ã:\n"
            "/start - –ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä\n"
            "/help - –ü–æ–º–æ—â—å\n"
            "/about - –û –±–æ—Ç–µ"
        )

def main():
    """–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è"""
    print("ü§ñ –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞ —é–Ω–∏—Ç-—ç–∫–æ–Ω–æ–º–∏–∫–∏...")
    print(f"üåê Web App URL: {WEB_APP_URL}")
    
    try:
        bot.polling(none_stop=True)
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞: {e}")

if __name__ == '__main__':
    main()
